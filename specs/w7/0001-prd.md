# GenSlides 产品需求文档 (PRD)

## 概述

GenSlides 是一个本地运行的单页应用，使用 Google Nano Banana Pro 模型根据文本内容生成图片幻灯片，并支持走马灯形式的全屏播放。

## 目标用户

需要快速生成视觉统一的幻灯片演示的本地用户。

## 技术栈

| 层级 | 技术选型 |
|------|----------|
| 后端 | Python + FastAPI + Google AI SDK |
| 前端 | TypeScript + Tailwind CSS + Zustand |
| 存储 | 本地文件系统（无数据库） |

## 功能需求

### 1. 核心功能

#### 1.1 Slides 管理

- **唯一标识**: 每个 slide 拥有唯一的 `sid`（slide id），与其子图片关联
- **单击预览**: 用户单击侧边栏某个 slide，在右侧预览区显示对应的图片
- **双击编辑**: 用户双击侧边栏某个 slide，可以编辑该 slide 的文字内容；文字内容变更后自动触发新图片生成
- **拖拽排序**: 用户选中并拖拽侧边栏的 slide，可以改变 slides 的顺序
- **新建 Slide**: 用户点击某个 slide 后设定锚点，按回车键在该 slide 下方创建新的 slide

#### 1.2 图片生成

- **文本驱动**: 图片根据当前 slide 的文字内容自动生成
- **缓存机制**: 图片保存在路径 `<slug>/<文字blake3hash>.png`
  - 如果左侧选中的 slide 文字 blake3 hash 一致的图片存在，则直接展示
  - 如果不存在，展示最新的一张图片，并支持刷新重新生成
- **并行处理**: 图片生成支持并行处理，slides 之间互不影响
- **实时更新**: 当最新图片完成时，需触发更新通知

#### 1.3 播放功能

- **全屏播放**: 点击「播放」按钮，从当前选中的 slide 开始全屏播放
- **走马灯模式**: slides 以走马灯（carousel）形式连续播放

### 2. 页面布局

```
+------------------------------------------------------------------+
| Logo: GenSlides          http://localhost:3003/<slug>     [播放]  |
+------------------------------------------------------------------+
|                      |                                           |
|   slides 整体        |                                           |
|   +-----------+      |                                           |
|   | Slide 1   |      |         图片预览区域                       |
|   +-----------+      |                                           |
|   +-----------+      |    (根据选中slide的文字内容                 |
|   | Slide 2   |      |     生成的图片在此展示)                     |
|   +-----------+      |                                           |
|   ...                |                                           |
|                      |                                           |
+------------------------------------------------------------------+
```

### 3. URL 路由

- 访问 `http://localhost:3003/<slug>` 对应 `./slides/<slug>` 目录下的 slides
- 示例: `http://localhost:3003/hello-world` → `./slides/hello-world/`

## 数据存储

### 目录结构

```
./slides/
├── <slug>/
│   ├── outline.yml          # 包含所有文本信息及当前选择的prompt等
│   └── images/
│       └── <sid>/
│           └── <blake3hash>.jpg   # 某个slide下的图片
```

### outline.yml 示例

```yaml
title: "演示标题"
slides:
  - sid: "slide-001"
    content: "第一张幻灯片的文字内容"
  - sid: "slide-002"
    content: "第二张幻灯片的文字内容"
```

## 目标 (Goals)

1. **流畅的生成体验**: 支持流畅的 slides 生成，找到最优方案
2. **并行处理**: 图片生成应可并行处理，slides 之间互不影响；当最新图片完成时，需触发更新通知
3. **成本控制**: 注意展示最新 slides 的总成本

## 非目标 (Non-Goals)

1. **不支持导出为 pptx**: 当前版本不考虑 PowerPoint 导出功能
2. **无数据库**: 不使用数据库存储
3. **无权限管理**: 整个 app 运行在本地，不需要用户认证和权限管理

## API 设计（初步）

### 后端 API

| 方法 | 路径 | 描述 |
|------|------|------|
| GET | `/api/slides/{slug}` | 获取指定 slug 的所有 slides 信息 |
| POST | `/api/slides/{slug}` | 创建新的 slide |
| PUT | `/api/slides/{slug}/{sid}` | 更新指定 slide 的内容 |
| PUT | `/api/slides/{slug}/reorder` | 更新 slides 的顺序 |
| DELETE | `/api/slides/{slug}/{sid}` | 删除指定 slide |
| POST | `/api/slides/{slug}/{sid}/generate` | 触发图片生成 |
| GET | `/api/slides/{slug}/{sid}/image` | 获取 slide 对应的图片 |

### WebSocket

- `/ws/slides/{slug}` - 实时推送图片生成进度和完成通知

## 技术实现要点

1. **Blake3 哈希**: 使用 blake3 算法对 slide 文字内容进行哈希，作为图片文件名的一部分
2. **图片缓存**: 基于 blake3 hash 实现图片缓存，避免重复生成
3. **异步生成**: 使用 FastAPI 的异步特性，支持多个 slide 图片的并行生成
4. **状态管理**: 前端使用 Zustand 管理 slides 状态，支持实时更新
5. **Nano Banana Pro**: 集成 Google AI SDK，调用 Nano Banana Pro 模型生成图片

## 里程碑

### MVP (最小可行产品)

- [ ] 基础 slides 列表展示
- [ ] Slide 内容编辑
- [ ] 单张图片生成
- [ ] 图片预览
- [ ] 全屏播放（走马灯）

### 后续迭代

- [ ] 批量图片生成优化
- [ ] 视觉风格统一（用户可提供风格图片或文字描述）
- [ ] 生成进度实时展示
- [ ] 键盘快捷键支持
