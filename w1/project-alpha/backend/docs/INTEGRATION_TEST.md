# 集成测试指南

## 测试环境准备

### 1. 启动服务

```bash
# 启动数据库
docker-compose up -d

# 启动后端（新终端）
cd backend
./start-backend.sh

# 启动前端（新终端）
cd frontend
npm run dev
```

### 2. 加载测试数据

```bash
# 执行 seed.sql
docker-compose exec -T db psql -U ticketapp -d ticketapp < backend/docs/seed.sql
```

## 功能测试清单

### ✅ Ticket CRUD 操作

#### 创建 Ticket

- [ ] 点击 Header 中的「新建 Ticket」按钮
- [ ] 填写标题（必填）
- [ ] 填写描述（可选）
- [ ] 选择标签（可选）
- [ ] 点击「创建」按钮
- [ ] 验证 Ticket 出现在列表中
- [ ] 验证 Toast 提示显示成功

#### 编辑 Ticket

- [ ] 点击 Ticket 卡片右上角的菜单按钮
- [ ] 选择「编辑」
- [ ] 修改标题和描述
- [ ] 添加/移除标签
- [ ] 点击「保存」按钮
- [ ] 验证 Ticket 更新成功
- [ ] 验证 Toast 提示显示成功

#### 删除 Ticket

- [ ] 点击 Ticket 卡片右上角的菜单按钮
- [ ] 选择「删除」
- [ ] 确认删除对话框
- [ ] 验证 Ticket 从列表中移除
- [ ] 验证 Toast 提示显示成功

### ✅ Ticket 状态管理

#### 完成 Ticket

- [ ] 勾选 Ticket 卡片前的复选框
- [ ] 验证 Ticket 状态变为「已完成」
- [ ] 验证 Ticket 显示删除线和灰色样式
- [ ] 验证 `completed_at` 时间已设置

#### 取消完成 Ticket

- [ ] 取消勾选已完成 Ticket 的复选框
- [ ] 验证 Ticket 状态变为「进行中」
- [ ] 验证 Ticket 恢复正常样式
- [ ] 验证 `completed_at` 时间已清空

### ✅ 标签管理

#### 创建标签

- [ ] 点击侧边栏或表单中的「新建标签」按钮
- [ ] 输入标签名称
- [ ] 选择标签颜色
- [ ] 点击「创建」按钮
- [ ] 验证标签出现在标签列表中
- [ ] 验证标签可用于 Ticket

#### 编辑标签

- [ ] 点击标签旁的编辑按钮（如果存在）
- [ ] 修改标签名称和颜色
- [ ] 点击「保存」按钮
- [ ] 验证标签更新成功

#### 删除标签

- [ ] 点击标签旁的删除按钮（如果存在）
- [ ] 确认删除
- [ ] 验证标签从列表中移除
- [ ] 验证关联的 Ticket 不再显示该标签

### ✅ 筛选功能

#### 按状态筛选

- [ ] 选择「所有」- 验证显示所有 Ticket
- [ ] 选择「进行中」- 验证只显示未完成的 Ticket
- [ ] 选择「已完成」- 验证只显示已完成的 Ticket

#### 按标签筛选

- [ ] 选择一个标签
- [ ] 验证只显示包含该标签的 Ticket
- [ ] 选择多个标签
- [ ] 验证显示包含任一选中标签的 Ticket
- [ ] 取消选择所有标签
- [ ] 验证显示所有 Ticket

#### 按标题搜索

- [ ] 在搜索框中输入关键词
- [ ] 验证列表实时更新（防抖 300ms）
- [ ] 验证只显示标题包含关键词的 Ticket
- [ ] 清空搜索框
- [ ] 验证显示所有 Ticket

### ✅ 组合筛选

- [ ] 同时使用状态筛选、标签筛选和搜索
- [ ] 验证筛选结果正确
- [ ] 验证筛选条件可以独立清除

### ✅ 排序功能

- [ ] 验证默认按创建时间降序排列
- [ ] 测试按更新时间排序
- [ ] 测试按完成时间排序
- [ ] 测试按标题排序

### ✅ 分页功能

- [ ] 验证默认分页设置（page=1, page_size=20）
- [ ] 测试翻页功能（如果实现）
- [ ] 验证分页信息显示正确

## 边界情况测试

### ✅ 空状态

- [ ] 清空所有 Ticket，验证显示「暂无 Ticket」提示
- [ ] 无标签时，验证标签筛选区域正常显示

### ✅ 网络错误处理

- [ ] 停止后端服务
- [ ] 执行任何操作
- [ ] 验证显示错误 Toast 提示
- [ ] 验证 UI 不会崩溃

### ✅ 表单验证

- [ ] 创建 Ticket 时不填写标题
- [ ] 验证显示验证错误提示
- [ ] 创建标签时不填写名称
- [ ] 验证显示验证错误提示

### ✅ 并发操作

- [ ] 快速连续创建多个 Ticket
- [ ] 验证所有 Ticket 都创建成功
- [ ] 快速切换筛选条件
- [ ] 验证 UI 响应正常

## 性能测试

### ✅ 加载性能

- [ ] 验证首屏加载时间 < 2秒
- [ ] 验证列表加载显示骨架屏
- [ ] 验证数据加载完成后骨架屏消失

### ✅ 缓存策略

- [ ] 创建 Ticket 后，验证列表自动更新
- [ ] 编辑 Ticket 后，验证列表自动更新
- [ ] 删除 Ticket 后，验证列表自动更新
- [ ] 切换页面后返回，验证数据从缓存加载

### ✅ 请求优化

- [ ] 验证搜索防抖生效（300ms）
- [ ] 验证相同请求不会重复发送
- [ ] 验证筛选条件变化时请求正确更新

## UI/UX 测试

### ✅ 响应式设计

- [ ] 在桌面浏览器测试（1920x1080）
- [ ] 在平板浏览器测试（768x1024）
- [ ] 在手机浏览器测试（375x667）
- [ ] 验证布局自适应正常
- [ ] 验证文字大小合适
- [ ] 验证按钮大小合适

### ✅ 键盘导航

- [ ] 使用 Tab 键导航
- [ ] 使用 Enter/Space 键激活按钮
- [ ] 使用 Esc 键关闭对话框
- [ ] 验证焦点指示清晰

### ✅ 视觉反馈

- [ ] 验证 Loading 状态显示
- [ ] 验证 Toast 通知显示
- [ ] 验证悬停效果正常
- [ ] 验证点击反馈正常

## API 测试

使用 `test.rest` 文件测试所有 API 端点：

```bash
# 在 VS Code 中安装 REST Client 扩展
# 打开 backend/docs/test.rest
# 点击每个请求上方的 "Send Request" 按钮
```

### API 测试清单

- [ ] GET /api/v1/tags - 获取所有标签
- [ ] POST /api/v1/tags - 创建标签
- [ ] GET /api/v1/tags/{id} - 获取单个标签
- [ ] PUT /api/v1/tags/{id} - 更新标签
- [ ] DELETE /api/v1/tags/{id} - 删除标签
- [ ] GET /api/v1/tickets - 获取 Ticket 列表（支持筛选、排序、分页）
- [ ] POST /api/v1/tickets - 创建 Ticket
- [ ] GET /api/v1/tickets/{id} - 获取单个 Ticket
- [ ] PUT /api/v1/tickets/{id} - 更新 Ticket
- [ ] DELETE /api/v1/tickets/{id} - 删除 Ticket
- [ ] PATCH /api/v1/tickets/{id}/complete - 完成 Ticket
- [ ] PATCH /api/v1/tickets/{id}/reopen - 取消完成 Ticket
- [ ] POST /api/v1/tickets/{id}/tags - 添加标签到 Ticket
- [ ] DELETE /api/v1/tickets/{id}/tags - 从 Ticket 移除标签

## 测试报告模板

### 测试日期

- 日期：___________
- 测试人员：___________
- 环境：开发环境 / 测试环境 / 生产环境

### 测试结果汇总

- 总测试用例数：___________
- 通过：___________
- 失败：___________
- 跳过：___________

### 问题记录

1. **问题描述**：___________
   - **严重程度**：高 / 中 / 低
   - **复现步骤**：___________
   - **预期结果**：___________
   - **实际结果**：___________

### 性能指标

- 首屏加载时间：___________
- API 平均响应时间：___________
- 内存使用：___________

## 自动化测试建议

### 单元测试

- 使用 Jest + React Testing Library 测试组件
- 使用 pytest 测试后端服务

### E2E 测试

- 使用 Playwright 或 Cypress 进行端到端测试
- 覆盖主要用户流程

### API 测试

- 使用 pytest + httpx 测试 API 端点
- 验证请求/响应格式和业务逻辑
